import os
import sys
import json
import requests
import config as cfg
from helper import verify_type

class virustotal(object):
    def __init__(self):
        self.vttoken = cfg.virustotal 

    def check_vt(self, data):
        type = verify_type(data)
        params = {
            'apikey': '%s' % self.vttoken, 
            'resource': '%s' % data
        }

        headers = {
            "Accept-Encoding": "gzip, deflate",
            "User-Agent" : "gzip,  verify_python"
        }

        # FIX - Add URL
        if type == "hash":
            response = requests.get('https://www.virustotal.com/vtapi/v2/file/report', 
            params=params, headers=headers)
        else:
            return False

        if response.status_code == 200:
            return response.json()

        return False 

    def submit_file(self, filepath):
        params = {
            'apikey': '%s' % self.vttoken, 
        }
        files = {'file': (filepath, open(filepath, 'rb'))}

        response = requests.post('https://www.virustotal.com/vtapi/v2/file/scan', 
        files=files, params=params)
        if response.status_code == 200:
            return response.json()

        return False


if __name__ == "__main__":
    vt = virustotal(sys.argv[1])
    #data = vt.check_vt()
